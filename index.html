<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ACACIA â€¢ Garden Codex</title>
<meta name="description" content="This archive reads clearly and breathes quietly. Follow the keys below.">
<meta name="theme-color" content="#0b0b0e">
<style>
  :root{
    --bg:#0b0b0e;--fg:#e9e9ef;--muted:#b7b7c6;--card:#141419;--ring:#2ecc71;--link:#b9b6ff;--hair:#23232b
  }
  html,body{background:var(--bg);color:var(--fg);font-family:system-ui,Arial,sans-serif}
  main{max-width:860px;margin:3rem auto;padding:0 1rem}
  h1{font-size:2.4rem;margin:0 0 .5rem 0}
  p.lede{color:var(--muted);margin:.5rem 0 1.25rem}
  .leaf{display:inline-block;border:1px solid var(--ring);color:var(--ring);padding:.15rem .6rem;border-radius:999px;font-size:.9rem;margin-left:.4rem}
  section{margin:2rem 0}
  h2{font-size:1rem;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);margin:0 0 .6rem}
  .grid{display:grid;gap:.8rem}
  .card{background:var(--card);border:1px solid var(--hair);border-radius:14px;padding:1rem 1.2rem}
  .title{font-weight:600}
  a{color:var(--link);text-decoration:none}
  .hint{color:var(--muted);font-size:.95rem}
  .error{border-color:#633; background:#1a1111}
  footer{margin:2.5rem 0;color:var(--muted);font-size:.9rem}
</style>
<main>
  <h1>ACACIA â€¢ Garden Codex <span class="leaf">ðŸŒ¿</span></h1>
  <p class="lede">This archive reads clearly and breathes quietly. Follow the keys below.</p>

  <section id="cycles-sec">
    <h2>Cycles</h2>
    <div id="cycles" class="grid"></div>
    <div id="cycles-hint" class="hint"></div>
  </section>

  <section id="echoes-sec">
    <h2>Latest Echoes ðŸŒ±</h2>
    <div id="echoes" class="grid"></div>
    <div id="echoes-hint" class="hint"></div>
  </section>

  <footer id="stamp"></footer>
</main>

<script>
(async () => {
  const byId = (id) => document.getElementById(id);

  // helper to create a card
  function card(html, isError=false){
    const d = document.createElement('div');
    d.className = 'card' + (isError ? ' error' : '');
    d.innerHTML = html;
    return d;
  }

  // ---- CYCLES ----
  try {
    const res = await fetch('./cycles/manifest.json', {cache:'no-store'});
    if (!res.ok) throw new Error('manifest.json not found');
    const data = await res.json(); // { cycles: [ {title,file}, ... ] }

    if (Array.isArray(data.cycles) && data.cycles.length){
      data.cycles.forEach(c => {
        byId('cycles').appendChild(
          card(`<div class="title">${c.title}</div>
                <a href="./cycles/${c.file}">Open</a>`)
        );
      });
      byId('cycles-hint').textContent = '';
    } else {
      byId('cycles-hint').textContent = 'No cycles listed yet (manifest is empty).';
    }
  } catch (e){
    byId('cycles').appendChild(
      card('Could not load cycles (missing <code>cycles/manifest.json</code> or invalid JSON).', true)
    );
  }

  // ---- ECHOES ----
  try {
    const resE = await fetch('./echoes/feed.json', {cache:'no-store'});
    if (!resE.ok) throw new Error('feed.json not found');
    const feed = await resE.json(); // [ {id,title,body,date}, ... ]
    if (Array.isArray(feed) && feed.length){
      // newest first by date or id
      feed.sort((a,b) => String(b.date||'').localeCompare(String(a.date||'')) || String(b.id||'').localeCompare(String(a.id||'')));
      feed.slice(0,10).forEach(echo => {
        const safeTitle = echo.title && echo.title.trim() ? echo.title : `Echo #${echo.id}`;
        const when = echo.date ? new Date(echo.date).toLocaleString() : '';
        byId('echoes').appendChild(
          card(`<div class="title">${safeTitle}</div>
                <div class="hint">${when}</div>
                <div style="margin-top:.5rem;white-space:pre-wrap">${echo.body||''}</div>`)
        );
      });
      byId('echoes-hint').textContent = '';
    } else {
      byId('echoes-hint').textContent = 'No echoes yet. Open a GitHub Issue to plant one.';
    }
  } catch (e){
    byId('echoes').appendChild(
      card('Could not load echoes (missing <code>echoes/feed.json</code> or invalid JSON).', true)
    );
  }

  // ---- stamp ----
  const now = new Date();
  byId('stamp').textContent = 'Last updated â€¢ ' + now.toISOString().replace('T',' ').replace('Z',' UTC');
})();
</script>
</html>
